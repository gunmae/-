
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Prime Global Trader - Community Edition</title>
<script src="https://s3.tradingview.com/tv.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        /* === Deep Ultramarine Theme === */
        --bg-color: #0a192f;
        --card-bg: #112240;
        --header-bg: rgba(10, 25, 47, 0.95);
        --text-main: #e6f1ff;
        --text-sub: #8892b0;
        
        /* Accents */
        --accent-primary: #3b82f6; 
        --accent-up: #ff5f5f;      
        --accent-gold: #ffd700;
        --accent-teal: #64ffda;

        --border-radius: 16px;
        --nav-height: 60px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
        margin: 0; padding: 0; background: var(--bg-color); color: var(--text-main);
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
        overflow-x: hidden;
    }

    /* === Header === */
    header {
        position: sticky; top: 0; z-index: 100;
        background: var(--header-bg); backdrop-filter: blur(10px);
        padding: 0 20px; border-bottom: 1px solid #233554;
    }
    
    .top-bar { height: 60px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 1.2rem; font-weight: 800; color: #fff; display: flex; align-items: center; gap: 8px; }
    .market-ticker { height: 40px; overflow: hidden; border-bottom: 1px solid #233554; }

    /* === Navigation === */
    .nav-tabs {
        display: flex; gap: 15px; padding: 15px 20px; overflow-x: auto;
        background: var(--bg-color); scrollbar-width: none;
        position: sticky; top: 100px; z-index: 90;
    }
    .tab-btn {
        background: none; border: none; color: var(--text-sub); font-size: 1.1rem; 
        font-weight: 700; cursor: pointer; white-space: nowrap; padding-bottom: 5px;
        transition: 0.3s;
    }
    .tab-btn.active { color: #fff; border-bottom: 2px solid #fff; }

    /* === Content === */
    .container { padding: 0 20px 80px; max-width: 800px; margin: 0 auto; min-height: 100vh; }
    .section-title { font-size: 1.2rem; font-weight: bold; margin: 25px 0 15px; color: #fff; display: flex; align-items: center; gap: 8px; }
    .fire-icon { color: var(--accent-gold); }
    .content-section { display: none; animation: fadeIn 0.3s ease; }
    .content-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Hot List */
    .hot-list-container {
        height: 400px; overflow: hidden; border-radius: var(--border-radius); 
        background: var(--card-bg); border: 1px solid #233554; margin-bottom: 20px;
    }

    /* Stock List */
    .stock-list { display: flex; flex-direction: column; gap: 10px; }
    .list-item {
        background: var(--card-bg); border-radius: var(--border-radius); 
        display: flex; justify-content: space-between; align-items: center;
        padding: 0 20px; cursor: pointer; height: 85px; 
        transition: transform 0.2s; border: 1px solid transparent;
    }
    .list-item:active { transform: scale(0.98); background: #1a2f55; }
    .item-rank { font-size: 1.1rem; font-weight: bold; color: var(--text-sub); width: 30px; }
    .item-info { flex: 1; }
    .item-name { font-size: 1rem; font-weight: 700; color: #fff; margin-bottom: 4px; }
    .item-sub { font-size: 0.8rem; color: var(--text-sub); }
    .mini-chart-box { width: 140px; height: 100%; pointer-events: none; }

    /* === Detail Modal === */
    .detail-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--bg-color); z-index: 500; display: none; flex-direction: column;
        animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .detail-overlay.active { display: flex; }

    .detail-nav {
        padding: 0 20px; height: 60px; background: rgba(10, 25, 47, 0.98);
        display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #233554;
    }
    .back-btn { background: none; border: none; color: #fff; font-size: 1.2rem; cursor: pointer; }
    .detail-content { flex: 1; overflow-y: auto; padding-bottom: 40px; }

    /* Detail Tabs */
    .d-tabs { display: flex; border-bottom: 1px solid #233554; background: var(--bg-color); position: sticky; top: 0; z-index: 10; }
    .d-tab { flex: 1; text-align: center; padding: 15px 0; color: var(--text-sub); font-weight: 600; cursor: pointer; border-bottom: 2px solid transparent; }
    .d-tab.active { color: #fff; border-bottom-color: #fff; }
    .d-view { display: none; padding: 20px; }
    .d-view.active { display: block; }
    .widget-card { background: var(--card-bg); border-radius: var(--border-radius); overflow: hidden; margin-bottom: 20px; border: 1px solid #233554; }

    /* === Community Styles (New) === */
    .comm-input-box {
        background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #233554;
    }
    .comm-textarea {
        width: 100%; background: #0a192f; border: 1px solid #233554; color: #fff; padding: 10px; border-radius: 8px;
        resize: none; font-family: inherit; margin-bottom: 10px; outline: none;
    }
    .comm-textarea:focus { border-color: var(--accent-primary); }
    .comm-btn-row { text-align: right; }
    .comm-submit-btn {
        background: var(--accent-primary); color: #fff; border: none; padding: 8px 16px; 
        border-radius: 20px; font-weight: bold; cursor: pointer;
    }

    .post-item {
        background: var(--card-bg); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #233554;
    }
    .post-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85rem; color: var(--text-sub); }
    .post-body { color: #e6f1ff; line-height: 1.5; margin-bottom: 12px; font-size: 0.95rem; }
    .post-actions { display: flex; gap: 15px; }
    .action-btn { 
        background: rgba(255,255,255,0.05); border: none; color: var(--text-sub); 
        padding: 5px 12px; border-radius: 15px; cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 5px;
        transition: 0.2s;
    }
    .action-btn.liked { color: var(--accent-up); background: rgba(255, 95, 95, 0.1); }
    .action-btn.disliked { color: var(--accent-primary); background: rgba(59, 130, 246, 0.1); }

    /* Buy Button */
    .fab-buy {
        position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
        width: 90%; max-width: 400px; padding: 18px;
        background: var(--accent-primary); color: #fff; font-weight: 800; font-size: 1.1rem;
        border: none; border-radius: 30px; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        cursor: pointer; z-index: 600; display: none;
    }
    .detail-overlay.active .fab-buy { display: block; animation: popIn 0.4s 0.3s backwards; }
    @keyframes popIn { from { transform: translate(-50%, 50px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

</style>
</head>
<body>

<header>
    <div class="top-bar">
        <div class="logo"><i class="fas fa-chart-pie"></i> PRIME TRADER</div>
        <div style="font-size:0.8rem; color:var(--text-sub);">Live Market</div>
    </div>
    <div class="market-ticker" id="market-ticker"></div>
</header>

<nav class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('all')">홈</button>
    <button class="tab-btn" onclick="switchTab('crypto')">가상화폐</button>
    <button class="tab-btn" onclick="switchTab('us')">해외주식</button>
    <button class="tab-btn" onclick="switchTab('korea')">국내주식</button>
</nav>

<div class="container" id="main-container">
    <div id="section-hot">
        <div class="section-title"><i class="fas fa-fire fire-icon"></i> 실시간 급등 순위</div>
        <div class="hot-list-container" id="hot-list-widget"></div>
    </div>

    <div class="section-title">거래량 상위 종목</div>
    <div id="content-all" class="content-section active stock-list"></div>
    <div id="content-crypto" class="content-section stock-list"></div>
    <div id="content-us" class="content-section stock-list"></div>
    <div id="content-korea" class="content-section stock-list"></div>
</div>

<div id="detail-page" class="detail-overlay">
    <div class="detail-nav">
        <button class="back-btn" onclick="closeDetail()"><i class="fas fa-arrow-left"></i></button>
        <div style="text-align:center;">
            <div id="dt-name" style="font-weight:bold; color:#fff;">--</div>
            <div id="dt-ticker" style="font-size:0.75rem; color:var(--text-sub);">--</div>
        </div>
        <div style="width:24px;"></div>
    </div>

    <div id="dt-header-widget" style="height: 100px; background:rgba(10, 25, 47, 0.5);"></div>

    <div class="d-tabs">
        <div class="d-tab active" onclick="switchDetailView('chart')">차트</div>
        <div class="d-tab" onclick="switchDetailView('info')">정보</div>
        <div class="d-tab" onclick="switchDetailView('community')">커뮤니티</div>
    </div>

    <div class="detail-content">
        <div id="view-chart" class="d-view active">
            <div class="widget-card" id="chart-widget" style="height: 500px;"></div>
            <div class="section-title" style="font-size:1rem;">전문가 투자의견</div>
            <div class="widget-card" id="tech-widget" style="height: 300px;"></div>
        </div>

        <div id="view-info" class="d-view">
            <div class="section-title" style="font-size:1rem;">기업 개요 & 섹터</div>
            <div class="widget-card" id="profile-widget" style="height: 350px;"></div>
            <div class="section-title" style="font-size:1rem;">재무제표 & 실적</div>
            <div class="widget-card" id="financial-widget" style="height: 500px;"></div>
        </div>

        <div id="view-community" class="d-view">
            <div class="comm-input-box">
                <textarea id="comm-input" class="comm-textarea" rows="3" placeholder="이 종목에 대한 의견을 남겨주세요. (욕설, 비방 금지)"></textarea>
                <div class="comm-btn-row">
                    <button class="comm-submit-btn" onclick="addPost()">등록하기</button>
                </div>
            </div>
            
            <div class="section-title" style="font-size:1rem; margin-top:0;">실시간 토론방</div>
            <div id="user-posts-area">
                </div>

            <div class="section-title" style="font-size:1rem; margin-top:30px;">글로벌 트레이더 의견 (TradingView)</div>
            <div class="community-box" id="community-widget" style="height:500px;"></div>
        </div>
    </div>

    <button class="fab-buy" onclick="alert('증권사 API 연동 후 매수 가능합니다.')">매수하기</button>
</div>

<script>
    // === Mock Database ===
    const fullStockDB = [
        { id: 'BINANCE:BTCUSDT', n: '비트코인', t: 'crypto' },
        { id: 'BINANCE:ETHUSDT', n: '이더리움', t: 'crypto' },
        { id: 'BINANCE:XRPUSDT', n: '리플', t: 'crypto' },
        { id: 'BINANCE:DOGEUSDT', n: '도지코인', t: 'crypto' },
        { id: 'BINANCE:SOLUSDT', n: '솔라나', t: 'crypto' },
        { id: 'NASDAQ:NVDA', n: '엔비디아', t: 'us' },
        { id: 'NASDAQ:TSLA', n: '테슬라', t: 'us' },
        { id: 'NASDAQ:AAPL', n: '애플', t: 'us' },
        { id: 'NASDAQ:MSFT', n: '마이크로소프트', t: 'us' },
        { id: 'NASDAQ:AMD', n: 'AMD', t: 'us' },
        { id: 'KRX:005930', n: '삼성전자', t: 'korea' },
        { id: 'KRX:000660', n: 'SK하이닉스', t: 'korea' },
        { id: 'KRX:373220', n: 'LG에너지솔루션', t: 'korea' },
        { id: 'KRX:035420', n: 'NAVER', t: 'korea' },
        { id: 'KRX:005380', n: '현대차', t: 'korea' },
        { id: 'KRX:051910', n: 'LG화학', t: 'korea' },
        { id: 'KRX:005490', n: 'POSCO홀딩스', t: 'korea' },
        { id: 'DAQ:ECOPRO', n: '에코프로', t: 'korea' }
    ];

    let currentSymbol = ''; // 현재 보고 있는 종목

    window.onload = () => {
        loadHeaderTicker();
        loadHotList();
        renderAllLists();
    };

    // 1. 헤더 티커
    function loadHeaderTicker() {
        insertScript('market-ticker', 'https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js', {
            "symbols": [ { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500" }, { "proName": "FOREXCOM:NSXUSD", "title": "Nasdaq 100" }, { "proName": "BINANCE:BTCUSDT", "title": "Bitcoin" }, { "proName": "KRX:KOSPI", "title": "KOSPI" } ],
            "showSymbolLogo": true, "colorTheme": "dark", "isTransparent": true, "displayMode": "adaptive", "locale": "kr"
        });
    }

    // 2. 핫 리스트
    function loadHotList() {
        insertScript('hot-list-widget', 'https://s3.tradingview.com/external-embedding/embed-widget-hotlists.js', {
            "colorTheme": "dark", "dateRange": "12M", "exchange": "US", "showChart": true, "locale": "kr", "width": "100%", "height": "100%", "isTransparent": true
        });
    }

    // 3. 리스트 렌더링
    function renderAllLists() {
        renderSection(fullStockDB, 'content-all');
        renderSection(fullStockDB.filter(x => x.t === 'crypto'), 'content-crypto');
        renderSection(fullStockDB.filter(x => x.t === 'us'), 'content-us');
        renderSection(fullStockDB.filter(x => x.t === 'korea'), 'content-korea');
    }

    function renderSection(data, containerId) {
        const c = document.getElementById(containerId);
        c.innerHTML = '';
        data.forEach((item, index) => {
            const uid = `list-w-${containerId}-${index}`;
            const div = document.createElement('div');
            div.className = 'list-item';
            div.onclick = () => openDetail(item.id, item.n);
            div.innerHTML = `
                <div class="item-rank">${index + 1}</div>
                <div class="item-info"><div class="item-name">${item.n}</div><div class="item-sub">${item.id.split(':')[1]}</div></div>
                <div class="mini-chart-box" id="${uid}"></div>
            `;
            c.appendChild(div);
            insertScript(uid, 'https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js', {
                "symbol": item.id, "width": "100%", "height": "100%", "locale": "kr", "dateRange": "12M", "colorTheme": "dark", "isTransparent": true, "autosize": true, "largeChartUrl": ""
            });
        });
    }

    // 4. 상세 페이지
    function openDetail(symbol, name) {
        currentSymbol = symbol;
        document.getElementById('dt-name').innerText = name;
        document.getElementById('dt-ticker').innerText = symbol;
        document.getElementById('detail-page').classList.add('active');
        switchDetailView('chart');
        
        insertScript('dt-header-widget', 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-info.js', { "symbol": symbol, "width": "100%", "locale": "kr", "colorTheme": "dark", "isTransparent": true });
        new TradingView.widget({ "container_id": "chart-widget", "symbol": symbol, "interval": "D", "theme": "dark", "width": "100%", "height": "100%", "locale": "kr", "backgroundColor": "rgba(17, 34, 64, 1)", "hide_side_toolbar": false });
        insertScript('tech-widget', 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js', { "symbol": symbol, "interval": "1D", "width": "100%", "height": "100%", "colorTheme": "dark", "isTransparent": true, "locale": "kr" });
        insertScript('profile-widget', 'https://s3.tradingview.com/external-embedding/embed-widget-symbol-profile.js', { "symbol": symbol, "width": "100%", "height": "100%", "colorTheme": "dark", "isTransparent": true, "locale": "kr" });
        
        if(!symbol.includes('BINANCE')) {
            insertScript('financial-widget', 'https://s3.tradingview.com/external-embedding/embed-widget-financials.js', { "symbol": symbol, "colorTheme": "dark", "isTransparent": true, "displayMode": "regular", "width": "100%", "height": "100%", "locale": "kr" });
        } else {
            document.getElementById('financial-widget').innerHTML = "<div style='padding:20px; text-align:center; color:#8892b0;'>암호화폐는 재무제표가 없습니다.</div>";
        }
        
        // Load Global Community (Read-only)
        document.getElementById('community-widget').innerHTML = '';
        const commScript = document.createElement('script');
        commScript.type = 'text/javascript'; commScript.async = true;
        commScript.src = 'https://s3.tradingview.com/external-embedding/embed-widget-ideas.js';
        commScript.innerHTML = JSON.stringify({ "symbol": symbol, "colorTheme": "dark", "isTransparent": false, "locale": "kr", "width": "100%", "height": "100%", "sort": "recent" });
        document.getElementById('community-widget').appendChild(commScript);

        // Load Local User Posts
        loadPosts();
    }

    // === Community Logic (Local Simulation) ===
    function getStorageKey() { return `pgt_posts_${currentSymbol}`; }

    function loadPosts() {
        const area = document.getElementById('user-posts-area');
        area.innerHTML = '';
        const raw = localStorage.getItem(getStorageKey());
        const posts = raw ? JSON.parse(raw) : [];

        if(posts.length === 0) {
            area.innerHTML = '<div style="padding:20px; text-align:center; color:#8892b0; font-size:0.9rem;">아직 작성된 의견이 없습니다. 첫 번째 의견을 남겨보세요!</div>';
            return;
        }

        posts.reverse().forEach((post, idx) => {
            const div = document.createElement('div');
            div.className = 'post-item';
            div.innerHTML = `
                <div class="post-header">
                    <span>${post.author}</span>
                    <span>${post.time}</span>
                </div>
                <div class="post-body">${post.text}</div>
                <div class="post-actions">
                    <button class="action-btn ${post.liked ? 'liked' : ''}" onclick="likePost(${post.id}, true)">
                        <i class="fas fa-thumbs-up"></i> ${post.likes}
                    </button>
                    <button class="action-btn ${post.disliked ? 'disliked' : ''}" onclick="likePost(${post.id}, false)">
                        <i class="fas fa-thumbs-down"></i> ${post.dislikes}
                    </button>
                </div>
            `;
            area.appendChild(div);
        });
    }

    function addPost() {
        const input = document.getElementById('comm-input');
        const text = input.value.trim();
        if(!text) { alert('내용을 입력해주세요.'); return; }

        const raw = localStorage.getItem(getStorageKey());
        const posts = raw ? JSON.parse(raw) : [];
        
        const now = new Date();
        const timeString = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes()}`;

        const newPost = {
            id: Date.now(),
            author: '익명의 트레이더',
            text: text,
            time: timeString,
            likes: 0,
            dislikes: 0,
            liked: false,
            disliked: false
        };

        posts.push(newPost);
        localStorage.setItem(getStorageKey(), JSON.stringify(posts));
        input.value = ''; // 초기화
        loadPosts(); // 다시 그리기
    }

    function likePost(postId, isLike) {
        const raw = localStorage.getItem(getStorageKey());
        let posts = raw ? JSON.parse(raw) : [];
        
        const post = posts.find(p => p.id === postId);
        if(post) {
            if(isLike) {
                if(!post.liked) { post.likes++; post.liked = true; }
                else { post.likes--; post.liked = false; } // 토글
            } else {
                if(!post.disliked) { post.dislikes++; post.disliked = true; }
                else { post.dislikes--; post.disliked = false; } // 토글
            }
            localStorage.setItem(getStorageKey(), JSON.stringify(posts));
            loadPosts();
        }
    }

    // === Helpers ===
    function closeDetail() { document.getElementById('detail-page').classList.remove('active'); document.getElementById('chart-widget').innerHTML = ''; }
    function switchTab(tabId) {
        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId === 'all' ? 'content-all' : `content-${tabId}`).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('section-hot').style.display = (tabId === 'all') ? 'block' : 'none';
    }
    function switchDetailView(viewId) {
        document.querySelectorAll('.d-view').forEach(el => el.classList.remove('active'));
        document.getElementById(`view-${viewId}`).classList.add('active');
        document.querySelectorAll('.d-tab').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
    }
    function insertScript(id, src, config) {
        const c = document.getElementById(id);
        if(!c) return;
        c.innerHTML = '';
        const s = document.createElement('script');
        s.type = 'text/javascript'; s.async = true; s.src = src;
        s.innerHTML = JSON.stringify(config);
        c.appendChild(s);
    }
</script>
</body>
</html>
